<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AURA GYM | Admin Dashboard</title>
    
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Styles -->
    <link rel="stylesheet" href="/css/admin.css">
    
    <!-- Script -->
    <script src="/js/admin.js" defer></script>
</head>
<body>

    <div id="admin-app">
        
        <% if (success && success.length) { %>
            <div class="flash-success">
                <%= success[0] %>
            </div>
        <% } %>
        <% if (error && error.length) { %>
            <div class="flash-error">
                <%= error[0] %>
            </div>
        <% } %>
        
        <!-- Bootstrap server-side members for JS -->
        <script>
            window.ADMIN_MEMBERS = <%- JSON.stringify(typeof members !== 'undefined' ? members : []) %>;
        </script>

        <!-- Sidebar Navigation -->
        <aside id="sidebar">
            <div class="sidebar-header">
                <a href="#" class="logo">
                    <i class="fa-solid fa-bolt"></i> AURA<span>ADMIN</span>
                </a>
            </div>

            <nav class="sidebar-menu">
                <ul>
                    <li>
                        <a href="#admin-overview" class="nav-link active" data-target="admin-overview">
                            <i class="fa-solid fa-chart-pie"></i>
                            <span>Overview</span>
                        </a>
                    </li>
                    <li>
                        <a href="#members-management" class="nav-link" data-target="members-management">
                            <i class="fa-solid fa-users"></i>
                            <span>Members</span>
                        </a>
                    </li>
                    <li>
                        <a href="#workouts-analytics" class="nav-link" data-target="workouts-analytics">
                            <i class="fa-solid fa-dumbbell"></i>
                            <span>Workouts</span>
                        </a>
                    </li>
                    <li>
                        <a href="#nutrition-analytics" class="nav-link" data-target="nutrition-analytics">
                            <i class="fa-solid fa-apple-whole"></i>
                            <span>Nutrition</span>
                        </a>
                    </li>
                    <li>
                        <a href="#subscriptions" class="nav-link" data-target="subscriptions">
                            <i class="fa-solid fa-credit-card"></i>
                            <span>Subscriptions</span>
                        </a>
                    </li>
                    <li>
                        <a href="#reports" class="nav-link" data-target="reports">
                            <i class="fa-solid fa-file-invoice"></i>
                            <span>Reports</span>
                        </a>
                    </li>
                    <li>
                        <a href="#settings" class="nav-link" data-target="settings">
                            <i class="fa-solid fa-sliders"></i>
                            <span>Settings</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <form action="/" method="GET">
                <div class="sidebar-footer">
                    <button id="logout-btn">
                        <i class="fa-solid fa-right-from-bracket"></i>
                        <span>Log Out</span>
                    </button>
                </div>
            </form>
        </aside>

        <!-- Main Content Wrapper -->
        <div id="main-wrapper">
            
            <!-- Top Navbar -->
            <header id="top-navbar">
                <button id="sidebar-toggle"><i class="fa-solid fa-bars"></i></button>
                
                <div class="page-title">
                    <h2 id="current-page-title">Dashboard Overview</h2>
                </div>

                <div class="header-actions">
                    <button class="icon-btn notification-btn">
                        <i class="fa-solid fa-bell"></i>
                        <span class="badge-dot"></span>
                    </button>
                    <div class="admin-profile">
                        <div class="admin-info">
                            <span class="admin-name"><%= currentUser.username%></span>
                            <span class="admin-role">Super Admin</span>
                        </div>
                        <img src="https://ui-avatars.com/api/?name=Admin+User&background=39ff14&color=000" alt="Admin" class="avatar">
                    </div>
                </div>
            </header>

            <!-- Main Content Area -->
            <main id="content-area">

                <!-- 1. Overview Section -->
                <section id="admin-overview" class="view-section active">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon green"><i class="fa-solid fa-users"></i></div>
                            <div class="stat-details">
                                <h3>Total Members</h3>
                                <div class="stat-number" id="total-members">0</div>
                                <span class="stat-trend positive"><i class="fa-solid fa-arrow-up"></i> +12%</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon blue"><i class="fa-solid fa-dumbbell"></i></div>
                            <div class="stat-details">
                                <h3>Total Workouts</h3>
                                <div class="stat-number" id="total-workouts">0</div>
                                <span class="stat-trend positive"><i class="fa-solid fa-arrow-up"></i> +5%</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon purple"><i class="fa-solid fa-credit-card"></i></div>
                            <div class="stat-details">
                                <h3>Active Subs</h3>
                                <div class="stat-number" id="active-subs">0</div>
                                <span class="stat-trend negative"><i class="fa-solid fa-arrow-down"></i> -2%</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon orange"><i class="fa-solid fa-dollar-sign"></i></div>
                            <div class="stat-details">
                                <h3>Est. Revenue</h3>
                                <div class="stat-number">$12.5k</div>
                                <span class="stat-label">This Month</span>
                            </div>
                        </div>
                    </div>

                    <div class="overview-charts">
                        <div class="chart-box">
                            <div class="chart-header">
                                <h3>Revenue Growth</h3>
                                <select class="chart-filter">
                                    <option>Last 6 Months</option>
                                    <option>Year to Date</option>
                                </select>
                            </div>
                            <canvas id="revenueChart"></canvas>
                        </div>
                        <div class="chart-box">
                            <div class="chart-header">
                                <h3>Membership Tiers</h3>
                            </div>
                            <canvas id="membershipPieChart"></canvas>
                        </div>
                    </div>
                </section>

                <!-- 2. Members Management -->
                <section id="members-management" class="view-section">
                    
                    <!-- Member Insight Stats -->
                    <div class="member-stats-row scroll-reveal">
                        <div class="m-stat-card">
                            <div class="m-stat-icon"><i class="fa-solid fa-users"></i></div>
                            <div class="m-stat-data">
                                <span>Total Members</span>
                                <h3 class="counter" data-target="1245">0</h3>
                            </div>
                        </div>
                        <div class="m-stat-card active-glow">
                            <div class="m-stat-icon"><i class="fa-solid fa-heart-pulse"></i></div>
                            <div class="m-stat-data">
                                <span>Active Now</span>
                                <h3 class="counter" data-target="142">0</h3>
                            </div>
                        </div>
                        <div class="m-stat-card">
                            <div class="m-stat-icon"><i class="fa-solid fa-crown"></i></div>
                            <div class="m-stat-data">
                                <span>Pro / Elite</span>
                                <h3 class="counter" data-target="854">0</h3>
                            </div>
                        </div>
                        <div class="m-stat-card">
                            <div class="m-stat-icon"><i class="fa-solid fa-user-plus"></i></div>
                            <div class="m-stat-data">
                                <span>New This Week</span>
                                <h3 class="counter" data-target="38">0</h3>
                            </div>
                        </div>
                    </div>

                    <!-- Advanced Control Bar -->
                    <div class="members-control-bar glass-panel scroll-reveal delay-100">
                        <div class="control-top">
                            <div class="search-wrapper">
                                <i class="fa-solid fa-magnifying-glass"></i>
                                <input type="text" id="member-search" placeholder="Search by name, email, or plan...">
                                <div class="search-focus-border"></div>
                            </div>
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-outline"><i class="fa-solid fa-file-export"></i> Export</button>
                                <button class="btn btn-sm btn-primary"><i class="fa-solid fa-user-plus"></i> Add Member</button>
                            </div>
                        </div>
                        <div class="control-bottom">
                            <div class="filter-pills">
                                <button class="pill active" data-filter="all">All Members</button>
                                <button class="pill" data-filter="active"><span class="dot active"></span> Active</button>
                                <button class="pill" data-filter="inactive"><span class="dot inactive"></span> Inactive</button>
                                <span class="divider"></span>
                                <button class="pill" data-filter="pro">Pro Plan</button>
                                <button class="pill" data-filter="elite">Elite Plan</button>
                            </div>
                            <div class="results-count">
                                Showing <span id="current-count">0</span> of <span id="total-count">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Premium Table -->
                    <div class="table-container scroll-reveal delay-200">
                        <table class="admin-table" id="members-table">
                            <thead>
                                <tr>
                                    <th>Member Profile</th>
                                    <th>Status</th>
                                    <th>Membership</th>
                                    <th>Joined Date</th>
                                    <th>Last Activity</th>
                                    <th class="text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- 3. Workouts Analytics -->
                <section id="workouts-analytics" class="view-section">
                    <div class="section-header scroll-reveal">
                        <h2>Workout Analytics</h2>
                        <p class="section-desc">Real-time tracking of popular programs and gym usage.</p>
                    </div>

                    <!-- Visual Workout Cards Grid -->
                    <div class="workout-analytics-grid">
                        <div class="wa-card scroll-reveal">
                            <div class="wa-bg" style="background-image: url('/images/upper_b.png');"></div>
                            <div class="wa-overlay"></div>
                            <div class="wa-content">
                                <div class="wa-top">
                                    <span class="wa-badge popular">Most Popular</span>
                                    <button class="wa-more"><i class="fa-solid fa-ellipsis"></i></button>
                                </div>
                                <div class="wa-bottom">
                                    <h3>Upper Body Power</h3>
                                    <div class="wa-stats">
                                        <div class="wa-stat"><span>Completions</span><strong>4,230</strong></div>
                                        <div class="wa-growth up"><i class="fa-solid fa-arrow-up"></i> 12%</div>
                                    </div>
                                    <div class="wa-progress-track"><div class="wa-progress-fill" style="width: 85%"></div></div>
                                </div>
                            </div>
                        </div>
                        <div class="wa-card scroll-reveal delay-100">
                            <div class="wa-bg" style="background-image: url('/images/hiit_g.png');"></div>
                            <div class="wa-overlay"></div>
                            <div class="wa-content">
                                <div class="wa-top"><span class="wa-badge trending">Trending</span></div>
                                <div class="wa-bottom">
                                    <h3>HIIT Shred</h3>
                                    <div class="wa-stats">
                                        <div class="wa-stat"><span>Completions</span><strong>2,845</strong></div>
                                        <div class="wa-growth up"><i class="fa-solid fa-arrow-up"></i> 24%</div>
                                    </div>
                                    <div class="wa-progress-track"><div class="wa-progress-fill" style="width: 65%"></div></div>
                                </div>
                            </div>
                        </div>
                        <div class="wa-card scroll-reveal delay-200">
                            <div class="wa-bg" style="background-image: url('/images/running_girl3.png');"></div>
                            <div class="wa-overlay"></div>
                            <div class="wa-content">
                                <div class="wa-top"><span class="wa-badge stable">Stable</span></div>
                                <div class="wa-bottom">
                                    <h3>Endurance Run</h3>
                                    <div class="wa-stats">
                                        <div class="wa-stat"><span>Completions</span><strong>1,920</strong></div>
                                        <div class="wa-growth down"><i class="fa-solid fa-arrow-down"></i> 3%</div>
                                    </div>
                                    <div class="wa-progress-track"><div class="wa-progress-fill" style="width: 45%"></div></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Split Section -->
                    <div class="analytics-split-row">
                        <div class="peak-hours-card glass-panel scroll-reveal delay-100">
                            <h3>Peak Gym Hours</h3>
                            <div class="bar-chart-container">
                                <div class="chart-bar-group">
                                    <div class="bar" style="--h: 20%;" data-time="6am"></div>
                                    <div class="bar" style="--h: 40%;" data-time="9am"></div>
                                    <div class="bar" style="--h: 30%;" data-time="12pm"></div>
                                    <div class="bar peak" style="--h: 85%;" data-time="5pm"></div>
                                    <div class="bar peak" style="--h: 95%;" data-time="6pm"></div>
                                    <div class="bar peak" style="--h: 70%;" data-time="7pm"></div>
                                    <div class="bar" style="--h: 40%;" data-time="9pm"></div>
                                </div>
                            </div>
                            <div class="chart-labels"><span>Morning</span><span>Afternoon</span><span>Evening</span></div>
                        </div>
                        <div class="top-performers-card glass-panel scroll-reveal delay-200">
                            <h3>Top Performers</h3>
                            <ul class="leaderboard-list">
                                <li class="leader-item rank-1">
                                    <div class="rank-badge">1</div>
                                    <div class="leader-avatar glow-avatar"><img src="https://ui-avatars.com/api/?name=J+D&background=random" alt="User"></div>
                                    <div class="leader-info"><strong>John Doe</strong><span>24 Workouts</span></div>
                                    <div class="leader-trend up"><i class="fa-solid fa-fire"></i></div>
                                </li>
                                <li class="leader-item rank-2">
                                    <div class="rank-badge">2</div>
                                    <div class="leader-avatar"><img src="https://ui-avatars.com/api/?name=S+M&background=random" alt="User"></div>
                                    <div class="leader-info"><strong>Sarah Miller</strong><span>21 Workouts</span></div>
                                </li>
                                <li class="leader-item rank-3">
                                    <div class="rank-badge">3</div>
                                    <div class="leader-avatar"><img src="https://ui-avatars.com/api/?name=M+R&background=random" alt="User"></div>
                                    <div class="leader-info"><strong>Mike Ross</strong><span>19 Workouts</span></div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- 4. Nutrition Analytics (REDESIGNED) -->
                <section id="nutrition-analytics" class="view-section">
                    <div class="section-header scroll-reveal">
                        <div>
                            <h2>Nutrition Insights</h2>
                            
                            
                        </div>
                        <p class="section-desc">Real-time nutrition trends across members</p>
                    </div>

                    <!-- Nutrition Cards Grid -->
                    <div class="nutrition-grid">
                        <!-- Card 1 -->
                        <div class="nutrition-card scroll-reveal">
                            <div class="nutrition-bg" style="background-image: url('/images/chicken.png');"></div>
                            <div class="nutrition-overlay"></div>
                            <div class="nutrition-badge highlight">Most Logged</div>
                            <div class="nutrition-content">
                                <div class="nutri-top">
                                    <h3>Chicken Breast</h3>
                                    <p>165 kcal / 100g</p>
                                </div>
                                <div class="nutri-bottom">
                                    <div class="log-stat">
                                        <i class="fa-solid fa-utensils"></i> <span>1,204 logs</span>
                                    </div>
                                    <div class="n-progress-track"><div class="n-progress-fill" style="width: 85%"></div></div>
                                </div>
                            </div>
                        </div>
                        <!-- Card 2 -->
                        <div class="nutrition-card scroll-reveal delay-100">
                            <div class="nutrition-bg" style="background-image: url('/images/protein_oats.png');"></div>
                            <div class="nutrition-overlay"></div>
                            <div class="nutrition-badge healthy">High Fiber</div>
                            <div class="nutrition-content">
                                <div class="nutri-top">
                                    <h3>Oats Bowl</h3>
                                    <p>300 kcal / serving</p>
                                </div>
                                <div class="nutri-bottom">
                                    <div class="log-stat">
                                        <i class="fa-solid fa-bowl-rice"></i> <span>980 logs</span>
                                    </div>
                                    <div class="n-progress-track"><div class="n-progress-fill" style="width: 65%"></div></div>
                                </div>
                            </div>
                        </div>
                        <!-- Card 3 -->
                        <div class="nutrition-card scroll-reveal delay-200">
                            <div class="nutrition-bg" style="background-image: url('/images/eggs.png');"></div>
                            <div class="nutrition-overlay"></div>
                            <div class="nutrition-badge protein">Protein Snack</div>
                            <div class="nutrition-content">
                                <div class="nutri-top">
                                    <h3>Boiled Eggs</h3>
                                    <p>70 kcal / egg</p>
                                </div>
                                <div class="nutri-bottom">
                                    <div class="log-stat">
                                        <i class="fa-solid fa-egg"></i> <span>850 logs</span>
                                    </div>
                                    <div class="n-progress-track"><div class="n-progress-fill" style="width: 50%"></div></div>
                                </div>
                            </div>
                        </div>
                         <!-- Card 4 -->
                         <div class="nutrition-card scroll-reveal delay-200">
                            <div class="nutrition-bg" style="background-image: url('/images/salad.png');"></div>
                            <div class="nutrition-overlay"></div>
                            <div class="nutrition-badge trending">Trending</div>
                            <div class="nutrition-content">
                                <div class="nutri-top">
                                    <h3>Mixed Salad</h3>
                                    <p>120 kcal / bowl</p>
                                </div>
                                <div class="nutri-bottom">
                                    <div class="log-stat">
                                        <i class="fa-solid fa-leaf"></i> <span>640 logs</span>
                                    </div>
                                    <div class="n-progress-track"><div class="n-progress-fill" style="width: 35%"></div></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Analytics Row: Macros + Trends -->
                    <div class="nutrition-split-row scroll-reveal delay-100">
                        <!-- Macro Bars -->
                        <div class="macro-panel glass-panel">
                            <h3>Macro Distribution Average</h3>
                            <div class="macro-list">
                                <!-- Protein -->
                                <div class="macro-item">
                                    <div class="macro-label"><span>Protein</span> <span>45%</span></div>
                                    <div class="macro-track"><div class="macro-bar protein" style="--w: 45%"></div></div>
                                </div>
                                <!-- Carbs -->
                                 <div class="macro-item">
                                    <div class="macro-label"><span>Carbs</span> <span>35%</span></div>
                                    <div class="macro-track"><div class="macro-bar carbs" style="--w: 35%"></div></div>
                                </div>
                                <!-- Fats -->
                                 <div class="macro-item">
                                    <div class="macro-label"><span>Fats</span> <span>20%</span></div>
                                    <div class="macro-track"><div class="macro-bar fats" style="--w: 20%"></div></div>
                                </div>
                            </div>
                        </div>

                        <!-- Trends -->
                        <div class="trends-panel glass-panel">
                            <h3>Monthly Trends</h3>
                            <div class="trend-item up">
                                <div class="trend-icon"><i class="fa-solid fa-arrow-trend-up"></i></div>
                                <div>
                                    <h4>Protein Intake</h4>
                                    <span>Up 12% vs last month</span>
                                </div>
                            </div>
                            <div class="trend-item down">
                                <div class="trend-icon"><i class="fa-solid fa-arrow-trend-down"></i></div>
                                <div>
                                    <h4>Sugar Consumption</h4>
                                    <span>Down 7% (Good job!)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 5. Subscriptions -->
                <section id="subscriptions" class="view-section">
                    <div class="section-header">
                        <h2>Subscription Plans</h2>
                    </div>
                    <div class="plans-grid">
                        <div class="plan-card">
                            <div class="plan-header">
                                <h4>Free Tier</h4>
                                <div class="price">$0<span>/mo</span></div>
                            </div>
                            <ul class="plan-features">
                                <li>3 Workouts / week</li>
                                <li>Basic Tracking</li>
                                <li>Ads Supported</li>
                            </ul>
                            <div class="plan-footer">
                                <span>1,205 Users</span>
                                <button class="btn btn-sm btn-outline">Edit</button>
                            </div>
                        </div>
                        <div class="plan-card featured">
                            <div class="plan-header">
                                <h4>Pro Tier</h4>
                                <div class="price">$19<span>/mo</span></div>
                            </div>
                            <ul class="plan-features">
                                <li>Unlimited Workouts</li>
                                <li>AI Coaching</li>
                                <li>Advanced Analytics</li>
                            </ul>
                            <div class="plan-footer">
                                <span>854 Users</span>
                                <button class="btn btn-sm btn-primary">Edit</button>
                            </div>
                        </div>
                        <div class="plan-card">
                            <div class="plan-header">
                                <h4>Elite Tier</h4>
                                <div class="price">$49<span>/mo</span></div>
                            </div>
                            <ul class="plan-features">
                                <li>1-on-1 Coaching</li>
                                <li>Meal Plans</li>
                                <li>Priority Support</li>
                            </ul>
                            <div class="plan-footer">
                                <span>210 Users</span>
                                <button class="btn btn-sm btn-outline">Edit</button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 6. Reports -->
                <section id="reports" class="view-section">
                    <div class="section-header">
                        <h2>System Reports</h2>
                    </div>
                    <div class="reports-list">
                        <div class="report-item">
                            <div class="report-icon"><i class="fa-solid fa-file-pdf"></i></div>
                            <div class="report-info">
                                <h4>Monthly Revenue Report</h4>
                                <p>Generated on Oct 01, 2023</p>
                            </div>
                            <button class="btn btn-sm btn-outline" onclick="downloadReport()">Download</button>
                        </div>
                        <div class="report-item">
                            <div class="report-icon"><i class="fa-solid fa-file-csv"></i></div>
                            <div class="report-info">
                                <h4>User Engagement Statistics</h4>
                                <p>Generated on Oct 01, 2023</p>
                            </div>
                            <button class="btn btn-sm btn-outline" onclick="downloadReport()">Download</button>
                        </div>
                        <div class="report-item">
                            <div class="report-icon"><i class="fa-solid fa-file-lines"></i></div>
                            <div class="report-info">
                                <h4>New Signups Audit</h4>
                                <p>Generated on Sep 28, 2023</p>
                            </div>
                            <button class="btn btn-sm btn-outline" onclick="downloadReport()">Download</button>
                        </div>
                    </div>
                </section>

                <!-- 7. Settings -->
                <section id="settings" class="view-section">
                    <div class="settings-wrapper">
                        <h2>Admin Preferences</h2>
                        <div class="setting-group">
                            <div class="setting-row">
                                <div class="s-info">
                                    <h4>System Maintenance Mode</h4>
                                    <p>Prevents members from logging in.</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            <div class="setting-row">
                                <div class="s-info">
                                    <h4>Allow New Registrations</h4>
                                    <p>Toggle public signup form.</p>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" checked>
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            <div class="setting-row">
                                <div class="s-info">
                                    <h4>Global Notifications</h4>
                                    <p>Send push notifications to all active users.</p>
                                </div>
                                <button class="btn btn-sm btn-primary">Compose</button>
                            </div>
                        </div>
                    </div>
                </section>

            </main>
        </div>
    </div>

    <!-- Member Modal -->
    <div id="member-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Member Details</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body" id="member-modal-body">
                <!-- Content injected via JS -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline close-modal-btn">Close</button>
                <button class="btn btn-primary" id="save-member-btn">Save Changes</button>
            </div>
        </div>
    </div>

</body>
</html>